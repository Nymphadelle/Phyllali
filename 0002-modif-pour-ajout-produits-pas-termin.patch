From 6ddb71e05b4ce020655f670c1813dfead10e096d Mon Sep 17 00:00:00 2001
From: a <a>
Date: Thu, 5 Dec 2013 19:10:39 +0100
Subject: [PATCH 2/4] =?UTF-8?q?modif=20pour=20ajout=20produits,=20pas=20te?=
 =?UTF-8?q?rmin=C3=A9?=
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

---
 Classes/Produit.php     | 28 ++++++++++++++++++++++++++++
 Resources/javascript.js | 24 ++++++++++++++++++++++++
 ajax/ajouterproduit.php | 28 ++++++++++++++++++++--------
 index.php               |  2 +-
 4 files changed, 73 insertions(+), 9 deletions(-)

diff --git a/Classes/Produit.php b/Classes/Produit.php
index 1c6c2a5..dbe3dbc 100644
--- a/Classes/Produit.php
+++ b/Classes/Produit.php
@@ -5,6 +5,34 @@ require_once 'Connect.php';
 
 class Produit extends Connect{
 
+	public function insertProduct($cat,$user,$libelle,$description,$etat,$photo){
+		/* $sql = "SELECT ID_VILLE FROM VILLE WHERE NOM_VILLE='".strtoupper($ville)."' AND CODE_POSTAL_=".$cp."";
+		$ret = $this->executerRequete($sql);
+		$indiceVille = odbc_result($ret,'ID_VILLE');
+		
+		// si la ville n'existe pas on insËre
+		if ( $indiceVille == '' ) {
+			// on insËre 
+			$sql = "INSERT INTO VILLE(NOM_VILLE,CODE_POSTAL_) VALUES ('".strtoupper($ville)."', ".$cp.");";
+			$this->executerRequete($sql);
+			// obtenir le max de l'indice actuel
+			$sql = "SELECT MAX(ID_VILLE) as ID FROM VILLE";
+			$ret = $this->executerRequete($sql);
+			$indiceVille = odbc_result($ret,'ID');
+		}
+		 */
+		// on insËre l'utilisateur
+		$sql = "INSERT INTO PORDUIT (ID_CATEGORIE,UTIL_ID,LIBELLE_PDT,DESCRIPTION,DATE_FIN,ETAT,PHOTO_PDT) VALUES (".$cat.",".$user.",'".$libelle."','".$description."','','".$etat."','".$photo."');";
+		//$this->executerRequete($sql);
+		$sql = "SELECT MAX(UTIL_ID) as ID FROM UTILISATEUR";
+		//$ret = $this->executerRequete($sql);
+		//$indiceUtil = odbc_result($ret,'ID');
+		
+		// on insËre ses identifiants de connexion
+		$sql = "INSERT INTO CONNEXION (mail,mdp,util) VALUES ('".$mail."','".$mdp."',".$indiceUtil.");";
+		//$this->executerRequete($sql);
+	}
+	
 	//renvoie la liste des produits
 	public function getProduits(){
 		$sql ='select * from PRODUIT';
diff --git a/Resources/javascript.js b/Resources/javascript.js
index 117bd82..2c8cca2 100644
--- a/Resources/javascript.js
+++ b/Resources/javascript.js
@@ -45,7 +45,31 @@ $('#presentation').on('click', '#envoyer', function(event){
 	validerInscription();
 });
 
+//formulaire pour ajouter un objet
+$('html').on('click', '#ajouter', function(event){
+	// on annule le comportemet par d√©faut du bouton
+	event.preventDefault();
+	$.ajax({
+		type:"POST",
+		url:"ajax/ajouterproduit.php"
+	})
+	.done(function( html ) {
+		$("#presentation").html(html);
+	});
+});
 
+//ins√©rer un objet - fonctionne pas
+$('html').on('click', '#valider_objet', function(event){
+	alert();
+	$.ajax({
+		type:"POST",
+		url:"ajax/insererproduit.php"
+		data:{libele:$("#libelle").val(), cat:$("#cat").val(), description:$("#description").val(), etat:$("#etat").val(), delai:$("#etat").val(), photo:$("#photo").val()}
+	})
+	.done(function( html ) {
+		$(location).attr('href',"index.php");
+	});
+});
 
 // bouton connexion
 $("#connexion").click(function() {
diff --git a/ajax/ajouterproduit.php b/ajax/ajouterproduit.php
index a3980bc..0acfa40 100644
--- a/ajax/ajouterproduit.php
+++ b/ajax/ajouterproduit.php
@@ -11,28 +11,31 @@ require_once '../Classes/Categorie.php';
 		</TR>
 
 		<TR>
-			<TD>Cat&ecute;gorie</TD><!-- catÈgorie -->
+			<TD>Cat&eacute;gorie</TD><!-- catÈgorie -->
 			<TD>
-				<select name="select">
+				<select id="cat">
 				<?php
 				$cat = new Categorie;
+				
+				//on affiche chaque catÈgorie
 				$tab_cat = array();
 				$tab_cat = $cat->getCategories();
+				
+				
 				foreach($tab_cat as $row){
 					//print_r($row);
 					echo '<option value="'.$row['ID_CATEGORIE'].'">'.$row['NOM_CATEG'].'</option>';
 					
+					//on affiche les sous catÈgories directement sous leur catÈgorie
 					$tab_scat = array();
 					$tab_scat = $cat->getSousCategories($row['ID_CATEGORIE']);
+					
 					foreach($tab_scat as $row){
 						echo '<option value="'.$row['ID_CATEGORIE'].'"> - '.$row['NOM_CATEG'].'</option>';;
 					}
 				}
-				// <select name="select">
-					// <option value="1">bangalore</option>
-					// <option value="2">mumbai</option>
-				// </select>
 				?>
+				</select>
 			</TD>
 		</TR>
 
@@ -51,15 +54,24 @@ require_once '../Classes/Categorie.php';
 		</TR>
 
 		<TR>
+			<TD>Choix d&eacute;lai d'activit&eacute;</TD>
+			<TD>
+			<INPUT type=radio id="delai" value="12"><label>12 heures</label>
+			<INPUT type=radio id="delai" value="24" checked><label>24 heures</label>
+			<INPUT type=radio id="delai" value="48"><label>48 heures</label>
+			</TD>
+		</TR>
+		
+		<TR>
 			<TD>Photo</TD>
 			<TD>
-			<INPUT type=password id="photo">
+			<INPUT type=file id="photo">
 			</TD>
 		</TR>
 
 		<TR>
 			<TD COLSPAN=2>
-			<INPUT type="submit" value="Ajouter l'objet" id="ajouter">
+			<INPUT type="button" value="Ajouter l'objet" id="valider_objet">
 			</TD>
 		</TR>
 	</TABLE>
diff --git a/index.php b/index.php
index 44da95c..dbaa847 100644
--- a/index.php
+++ b/index.php
@@ -29,7 +29,7 @@ $produits = $donnees->getProduits();
 			echo "Bonjour ".$_SESSION['prenom'];
 			echo "</div>";
 			echo "<div id='buttons'>";
-			echo "<form method='POST' action ='ajax/ajouterproduit.php'><input type='submit' id='ajouter' value='+'></form>";
+			echo "<form method='POST' action ='#'><input type='submit' id='ajouter' value='+'></form>";
 			echo "<form method='POST' action ='ajax/decoclient.php'><input type='submit' id='deconnexion' value='DÈconnexion'></form>";
 			echo "</div>";
 		}
-- 
1.8.4.msysgit.0

